#!/bin/sh
set -eu

# Only check staged Rust files (skip docs-only commits, etc.)
staged_rs="$(git diff --cached --name-only --diff-filter=ACMR -- '*.rs')"
[ -z "$staged_rs" ] && exit 0

command -v rustfmt >/dev/null 2>&1 || {
  echo "rustfmt not found. Install with: rustup component add rustfmt" >&2
  exit 1
}

# Auto-format and re-stage
echo "$staged_rs" | xargs rustfmt
echo "$staged_rs" | xargs git add
